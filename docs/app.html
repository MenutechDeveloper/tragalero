<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tragalero App</title>
<link rel="manifest" href="./manifest.json">
<link href="./assets/css/app.css" rel="stylesheet" />
</head>


<body>
<div class="container">
  <div class="top-bar" id="topBar">
    <div class="instalacion">
        <a id="installContainer" href="javascript:void(0);">
            <img id="installBtn" src="https://menutechdeveloper.github.io/bddImg/assets/img/instalar.png" alt="Instalar">
        </a>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Buscar restaurante...">
    </div>

    <div class="controls">
        <label for="radioBusqueda">Resultados a:</label>
        <select id="radioBusqueda">
            <option value="5">5 km</option>
            <option value="10" selected>10 km</option>
            <option value="20">20 km</option>
            <option value="50">50 km</option>
            <option value="9999">Todos</option>
        </select>
    </div>
  </div>


<script>
// Hacer que la barra sea fija al hacer scroll
const topBar = document.getElementById('topBar');
const barOffset = topBar.offsetTop;

window.addEventListener('scroll', () => {
  if (window.scrollY > barOffset) {
    topBar.style.position = 'fixed';
    document.body.style.paddingTop = topBar.offsetHeight + 'px';
  } else {
    topBar.style.position = 'relative';
    document.body.style.paddingTop = '0';
  }
});
</script>
    <video class="ad" src="https://menutechdeveloper.github.io/bddImg/assets/img/directorio.mp4"autoplay muted loop alt="Encabezado"></video>
  

    <div id="restaurantsGrid" class="grid"></div>
</div>


<script>
// ======== ARRAY DE RESTAURANTES ========

const restaurantes = [
    { nombre: "El Herradero", lat: 32.493147555843194, lon: -117.04845390257702, url: "https://menutechdeveloper.github.io/restaurante2/", imagen: "https://menutech.services/assets/img/herradero.png" },
    { nombre: "Alex Tacos", lat: 32.49068611318261, lon: -117.04150161762415, url: "https://vikingantonio.github.io/alextacosapp/", imagen: "https://menutech.services/assets/img/LA%20COCINA%20DE%20TIJUANA%20(38).png" },
    { nombre: "La Salsita Pinchi", lat: 29.62599215208544, lon: -95.28398228466078, url: "https://lasalsitapinchi.com/app", imagen: "https://lasalsitapinchi.com/logo.jpg" },
        { nombre: "El Herradero", lat: 32.493147555843194, lon: -117.04845390257702, url: "https://menutechdeveloper.github.io/restaurante2/", imagen: "https://menutech.services/assets/img/herradero.png" },
    { nombre: "Alex Tacos", lat: 32.49068611318261, lon: -117.04150161762415, url: "https://vikingantonio.github.io/alextacosapp/", imagen: "https://menutech.services/assets/img/LA%20COCINA%20DE%20TIJUANA%20(38).png" },
    { nombre: "La Salsita Pinchi", lat: 29.62599215208544, lon: -95.28398228466078, url: "https://lasalsitapinchi.com/app", imagen: "https://lasalsitapinchi.com/logo.jpg" },
        { nombre: "El Herradero", lat: 32.493147555843194, lon: -117.04845390257702, url: "https://menutechdeveloper.github.io/restaurante2/", imagen: "https://menutech.services/assets/img/herradero.png" },
    { nombre: "Alex Tacos", lat: 32.49068611318261, lon: -117.04150161762415, url: "https://vikingantonio.github.io/alextacosapp/", imagen: "https://menutech.services/assets/img/LA%20COCINA%20DE%20TIJUANA%20(38).png" },
    { nombre: "La Salsita Pinchi", lat: 29.62599215208544, lon: -95.28398228466078, url: "https://lasalsitapinchi.com/app", imagen: "https://lasalsitapinchi.com/logo.jpg" },
        { nombre: "El Herradero", lat: 32.493147555843194, lon: -117.04845390257702, url: "https://menutechdeveloper.github.io/restaurante2/", imagen: "https://menutech.services/assets/img/herradero.png" },
    { nombre: "Alex Tacos", lat: 32.49068611318261, lon: -117.04150161762415, url: "https://vikingantonio.github.io/alextacosapp/", imagen: "https://menutech.services/assets/img/LA%20COCINA%20DE%20TIJUANA%20(38).png" },
    { nombre: "La Salsita Pinchi", lat: 29.62599215208544, lon: -95.28398228466078, url: "https://lasalsitapinchi.com/app", imagen: "https://lasalsitapinchi.com/logo.jpg" },
    { nombre: "La carreta", lat: 32.53166041871072, lon: -117.05082284762946, url: "https://lacarretarest.com/app", imagen: "https://lacarretarest.com/logo.png" }

];



let latUser = null;
let lonUser = null;

function calcularDistancia(lat1, lon1, lat2, lon2) {
    const R = 6371; 
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a =
        Math.sin(dLat / 2) ** 2 +
        Math.cos(lat1 * Math.PI / 180) *
        Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon / 2) ** 2;
    return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
}

function mostrarRestaurantes(radio) {
    const grid = document.getElementById('restaurantsGrid');
    grid.innerHTML = "";

    let lista = restaurantes;

    if (latUser !== null && lonUser !== null && radio < 9999) {
        lista = restaurantes
            .map(r => {
                const distancia = calcularDistancia(latUser, lonUser, r.lat, r.lon);
                return { ...r, distancia };
            })
            .filter(r => r.distancia <= radio)
            .sort((a, b) => a.distancia - b.distancia);
    }

    lista.forEach(r => {
        const link = document.createElement('a');
        link.href = r.url;
        link.innerHTML = `<img src="${r.imagen}" alt="${r.nombre}">`;
        grid.appendChild(link);
    });
}

// Detectar ubicación al cargar la web
if ("geolocation" in navigator) {
    navigator.geolocation.getCurrentPosition(
        (pos) => {
            latUser = pos.coords.latitude;
            lonUser = pos.coords.longitude;
            mostrarRestaurantes(parseInt(document.getElementById('radioBusqueda').value));
        },
        (error) => {
            console.warn("No se pudo obtener ubicación:", error.message);
            mostrarRestaurantes(9999); // Mostrar todos si no da permisos
        }
    );
} else {
    console.warn("Geolocalización no soportada.");
    mostrarRestaurantes(9999);
}

// Evento para cambiar radio sin recargar
document.getElementById('radioBusqueda').addEventListener('change', function() {
    mostrarRestaurantes(parseInt(this.value));
});
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(reg => console.log('SW registrado con scope:', reg.scope))
      .catch(err => console.error('Error registrando SW:', err));
  });
}
</script>
<script src="./assets/js/buscador.js"></script>
<script src="./instalarapp.js"></script>
</body>
</html>

