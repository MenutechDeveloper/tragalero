-- ==========================================================
-- SQL PARA REPARAR LA TABLA 'businesses' EN SUPABASE
-- ==========================================================
-- Copia y pega este código en el "SQL Editor" de tu panel de Supabase y ejecútalo.

-- 1. Asegurar que existan los campos básicos y de ubicación
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS name TEXT;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS category TEXT;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS city TEXT;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS state TEXT;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS zip TEXT;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS address_detail TEXT;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS logo_url TEXT;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS website TEXT;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS social_media JSONB DEFAULT '{}';
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS hours JSONB DEFAULT '{}';

-- 2. Campos de visibilidad y relación con usuario (Dueño)
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS owner_id UUID REFERENCES directory_users(id);
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS is_visible BOOLEAN DEFAULT TRUE;

-- 3. Campos específicos para Menutech y Restaurantes (El error order_bg_color está aquí)
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS is_restaurant BOOLEAN DEFAULT FALSE;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS cuid TEXT;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS ruid TEXT;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS has_reservation BOOLEAN DEFAULT FALSE;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS order_bg_color TEXT DEFAULT '#f2a04a';
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS order_text_color TEXT DEFAULT '#ffffff';
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS res_bg_color TEXT DEFAULT '#2f4854';
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS res_text_color TEXT DEFAULT '#ffffff';
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS order_url TEXT;
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS reservation_url TEXT;

-- 4. Otros campos que podrían faltar
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS btn_bg_color TEXT DEFAULT '#f1c40f';
ALTER TABLE businesses ADD COLUMN IF NOT EXISTS btn_text_color TEXT DEFAULT '#ffffff';

-- ==========================================================
-- NOTA IMPORTANTE:
-- Si después de ejecutar este SQL sigues recibiendo el mismo error:
-- 1. Ve a "Settings" (Icono de engranaje) en tu panel de Supabase.
-- 2. Entra en la sección "API".
-- 3. Busca el botón que dice "Reload PostgREST schema" y haz clic en él.
-- Esto refrescará la caché de columnas de Supabase.
-- ==========================================================
